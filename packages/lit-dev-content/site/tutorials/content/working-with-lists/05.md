When using the `map` directive or just providing an iterable within the
template, Lit creates a list of DOM nodes and updates them in the iteration
order, efficiently reusing any previously rendered nodes. This is **good** and
should be utilized when **all states are being controlled by Lit**.

However, when relying instead on the DOM nodes to keep some state that are not
controlled by Lit, buggy behavior could arise. This is an example of when the
`repeat` directive should be utilized.

Take a look at this example where each task item is rendered as a list item with
a checkbox using the `map` directive. There are buttons to sort the list items
in ascending or descending alphabetical order. The label text is provided by a
template expression but there is **no explicit component state** to hold whether
the item is checked or not.

Check one of the items and change the sort order. Notice that the item's label
text changes but not the position of the checked box. This is because the
checkbox state, which is not controlled by Lit, stays with the DOM nodes. During
update, Lit only updates the value of the text node holding the label without
reordering the DOM nodes.

Utilize the `repeat` directive to keep the list item and checkbox tied to the
specific item of the array. Using this directive with a key function lets Lit
maintain the **key-to-DOM** association between updates by moving the DOM nodes
when required.

Begin by importing the `repeat` directive.

{% switchable-sample %}

```ts
// my-element.ts
import {repeat} from 'lit/directives/repeat.js';
```

```js
// my-element.js
import {repeat} from 'lit/directives/repeat.js';
```

{% endswitchable-sample %}

Use it in place of the `map` directive, providing the iterable, a key function
that returns a unique identifier for a particular item, and the template to
render for each item.

{% switchable-sample %}

```ts
// my-element.ts
  render() {
    return html`
      ⋮
      <ul>
        ${repeat(
          this.tasks,
          (task) => task.id,
          (task) => html`
            <li>
              <label><input type="checkbox" />${task.label} (${task.id})</label>
            </li>
          `
        )}
      </ul>
    `;
  }
```

```js
// my-element.js
  render() {
    return html`
      ⋮
      <ul>
        ${repeat(
          this.tasks,
          (task) => task.id,
          (task) => html`
            <li>
              <label><input type="checkbox" />${task.label} (${task.id})</label>
            </li>
          `
        )}
      </ul>
    `;
  }
```

{% endswitchable-sample %}

Confirm that this is working correctly by checking an item and changing the sort
order. The check mark should now be moving to stay next to its original label.

<litdev-aside type="positive">

The key function provided must return a unique key for an item.

A key function that simply returns the index (or omitting the key function)
would have the same behavior as using `map`. See the [repeat
documentation](/docs/templates/directives/#repeat) for more details. Also see
[When to use map or repeat](/docs/templates/lists/#when-to-use-map-or-repeat)
for guidance on deciding when to use one or the other.

</listdev-aside>
